<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>towerse.tower &mdash; TowerSE 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="TowerSE 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">TowerSE 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for towerse.tower</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">towerstruc.py</span>

<span class="sd">Created by Andrew Ning on 2012-01-20.</span>
<span class="sd">Copyright (c) NREL. All rights reserved.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">VariableTree</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.api</span> <span class="kn">import</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="n">VarTree</span><span class="p">,</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">Bool</span>

<span class="kn">from</span> <span class="nn">commonse.utilities</span> <span class="kn">import</span> <span class="n">sind</span><span class="p">,</span> <span class="n">cosd</span><span class="p">,</span> <span class="n">linspace_with_deriv</span><span class="p">,</span> <span class="n">interp_with_deriv</span><span class="p">,</span> <span class="n">hstack</span><span class="p">,</span> <span class="n">vstack</span>
<span class="kn">from</span> <span class="nn">commonse.csystem</span> <span class="kn">import</span> <span class="n">DirectionVector</span>
<span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="kn">import</span> <span class="n">WindBase</span><span class="p">,</span> <span class="n">WaveBase</span><span class="p">,</span> <span class="n">SoilBase</span>
<span class="kn">from</span> <span class="nn">towerSupplement</span> <span class="kn">import</span> <span class="n">fatigue</span><span class="p">,</span> <span class="n">hoopStressEurocode</span><span class="p">,</span> <span class="n">shellBucklingEurocode</span><span class="p">,</span> \
    <span class="n">bucklingGL</span><span class="p">,</span> <span class="n">vonMisesStressUtilization</span>
<span class="kn">from</span> <span class="nn">akima</span> <span class="kn">import</span> <span class="n">Akima</span>


<span class="c"># &quot;Experiments on the Flow Past a Circular Cylinder at Very High Reynolds Numbers&quot;, Roshko</span>
<span class="n">Re_pt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0010</span><span class="p">,</span> <span class="mf">0.0100</span><span class="p">,</span> <span class="mf">0.0200</span><span class="p">,</span> <span class="mf">0.1220</span><span class="p">,</span> <span class="mf">0.2000</span><span class="p">,</span> <span class="mf">0.3000</span><span class="p">,</span> <span class="mf">0.4000</span><span class="p">,</span>
         <span class="mf">0.5000</span><span class="p">,</span> <span class="mf">1.0000</span><span class="p">,</span> <span class="mf">1.5000</span><span class="p">,</span> <span class="mf">2.0000</span><span class="p">,</span> <span class="mf">2.5000</span><span class="p">,</span> <span class="mf">3.0000</span><span class="p">,</span> <span class="mf">3.5000</span><span class="p">,</span> <span class="mf">4.0000</span><span class="p">,</span> <span class="mf">5.0000</span><span class="p">,</span> <span class="mf">10.0000</span><span class="p">]</span>
<span class="n">cd_pt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0000</span><span class="p">,</span>  <span class="mf">2.0000</span><span class="p">,</span> <span class="mf">1.1100</span><span class="p">,</span> <span class="mf">1.1100</span><span class="p">,</span> <span class="mf">1.2000</span><span class="p">,</span> <span class="mf">1.2000</span><span class="p">,</span> <span class="mf">1.1700</span><span class="p">,</span> <span class="mf">0.9000</span><span class="p">,</span> <span class="mf">0.5400</span><span class="p">,</span>
         <span class="mf">0.3100</span><span class="p">,</span> <span class="mf">0.3800</span><span class="p">,</span> <span class="mf">0.4600</span><span class="p">,</span> <span class="mf">0.5300</span><span class="p">,</span> <span class="mf">0.5700</span><span class="p">,</span> <span class="mf">0.6100</span><span class="p">,</span> <span class="mf">0.6400</span><span class="p">,</span> <span class="mf">0.6700</span><span class="p">,</span> <span class="mf">0.7000</span><span class="p">,</span> <span class="mf">0.7000</span><span class="p">]</span>

<span class="n">drag_spline</span> <span class="o">=</span> <span class="n">Akima</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Re_pt</span><span class="p">),</span> <span class="n">cd_pt</span><span class="p">,</span> <span class="n">delta_x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c"># exact akima because control points do not change</span>


<span class="c"># -----------------</span>
<span class="c">#  Helper Functions</span>
<span class="c"># -----------------</span>

<span class="k">def</span> <span class="nf">cylinderDrag</span><span class="p">(</span><span class="n">Re</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drag coefficient for a smooth circular cylinder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Re : array_like</span>
<span class="sd">        Reynolds number</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cd : array_like</span>
<span class="sd">        drag coefficient (normalized by cylinder diameter)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ReN</span> <span class="o">=</span> <span class="n">Re</span> <span class="o">/</span> <span class="mf">1.0e6</span>

    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Re</span><span class="p">)</span>
    <span class="n">dcd_dRe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Re</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">ReN</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">cd</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dcd_dRe</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">drag_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ReN</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
    <span class="n">dcd_dRe</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">Re</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>  <span class="c"># chain rule</span>

    <span class="k">return</span> <span class="n">cd</span><span class="p">,</span> <span class="n">dcd_dRe</span>




<span class="c"># -----------------</span>
<span class="c">#  Variable Trees</span>
<span class="c"># -----------------</span>

<span class="k">class</span> <span class="nc">AeroLoads</span><span class="p">(</span><span class="n">VariableTree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;wind/wave loads&quot;&quot;&quot;</span>

    <span class="n">Px</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed loads&#39;</span><span class="p">)</span>
    <span class="n">Py</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed loads&#39;</span><span class="p">)</span>
    <span class="n">Pz</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed loads&#39;</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dynamic pressure&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;corresponding heights&#39;</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;wind/wave angle relative to inertia c.s.&#39;</span><span class="p">)</span>


<span class="c"># -----------------</span>
<span class="c">#  Components</span>
<span class="c"># -----------------</span>


<span class="k">class</span> <span class="nc">TowerWindDrag</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;drag forces on a cylindrical tower due to wind&quot;&quot;&quot;</span>

    <span class="c"># variables</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;magnitude of wind speed&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;heights where wind speed was computed&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;corresponding diameter of cylinder section&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;corresponding wind angles relative to inertial coordinate system&#39;</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.225</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;air density&#39;</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.7934e-5</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/(m*s)&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dynamic viscosity of air&#39;</span><span class="p">)</span>
    <span class="n">cd_usr</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;User input drag coefficient to override Reynolds number based one&#39;</span><span class="p">)</span>

    <span class="c"># out</span>
    <span class="n">windLoads</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">AeroLoads</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;wind loads in inertial coordinate system&#39;</span><span class="p">)</span>

    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>

        <span class="c"># dynamic pressure</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span>

        <span class="c"># Reynolds number and drag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cd_usr</span><span class="p">:</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cd_usr</span>
            <span class="n">Re</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">dcd_dRe</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Re</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">U</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="n">mu</span>
            <span class="n">cd</span><span class="p">,</span> <span class="n">dcd_dRe</span> <span class="o">=</span> <span class="n">cylinderDrag</span><span class="p">(</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">cd</span><span class="o">*</span><span class="n">d</span>

        <span class="c"># components of distributed loads</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">Py</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">Pz</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">Fp</span>

        <span class="c"># pack data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="o">.</span><span class="n">Px</span> <span class="o">=</span> <span class="n">Px</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="o">.</span><span class="n">Py</span> <span class="o">=</span> <span class="n">Py</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="o">.</span><span class="n">Pz</span> <span class="o">=</span> <span class="n">Pz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>

        <span class="c"># derivatives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dq_dU</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">U</span>
        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dq_dU</span><span class="o">*</span><span class="n">cd</span> <span class="o">+</span> <span class="n">q</span><span class="o">*</span><span class="n">dcd_dRe</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dU</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dU</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="n">cd</span> <span class="o">+</span> <span class="n">dcd_dRe</span><span class="o">*</span><span class="n">Re</span><span class="p">)</span><span class="o">*</span><span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dd</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dd</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;windLoads.Px&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads.Py&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads.Pz&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads.q&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads.z&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

        <span class="n">zeron</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="n">dPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dU</span><span class="p">),</span> <span class="n">zeron</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dd</span><span class="p">)])</span>
        <span class="n">dPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dU</span><span class="p">),</span> <span class="n">zeron</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dd</span><span class="p">)])</span>
        <span class="n">dPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
        <span class="n">dq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dq_dU</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))])</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">zeron</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">zeron</span><span class="p">])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dPx</span><span class="p">,</span> <span class="n">dPy</span><span class="p">,</span> <span class="n">dPz</span><span class="p">,</span> <span class="n">dq</span><span class="p">,</span> <span class="n">dz</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>





<span class="k">class</span> <span class="nc">TowerWaveDrag</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;drag forces on a cylindrical tower due to waves&quot;&quot;&quot;</span>

    <span class="c"># variables</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;magnitude of wave speed&#39;</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;magnitude of wave acceleration&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;heights where wave speed was computed&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;corresponding diameter of cylinder section&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;corresponding wave angles relative to inertial coordinate system&#39;</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1027.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;water density&#39;</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.3351e-3</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/(m*s)&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dynamic viscosity of water&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass coefficient&#39;</span><span class="p">)</span>
    <span class="n">cd_usr</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;User input drag coefficient to override Reynolds number based one&#39;</span><span class="p">)</span>

    <span class="c"># out</span>
    <span class="n">waveLoads</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">AeroLoads</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;wave loads in inertial coordinate system&#39;</span><span class="p">)</span>


    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>

        <span class="c"># dynamic pressure</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span>

        <span class="c"># Reynolds number and drag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cd_usr</span><span class="p">:</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cd_usr</span>
            <span class="n">dcd_dRe</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Re</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">U</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="n">mu</span>
            <span class="n">cd</span><span class="p">,</span> <span class="n">dcd_dRe</span> <span class="o">=</span> <span class="n">cylinderDrag</span><span class="p">(</span><span class="n">Re</span><span class="p">)</span>

        <span class="c"># inertial and drag forces</span>
        <span class="n">Fi</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cm</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span>  <span class="c"># Morrison&#39;s equation</span>
        <span class="n">Fd</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">cd</span><span class="o">*</span><span class="n">d</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fi</span> <span class="o">+</span> <span class="n">Fd</span>

        <span class="c"># components of distributed loads</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">Py</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">Pz</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">Fp</span>

        <span class="c"># pack data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="o">.</span><span class="n">Px</span> <span class="o">=</span> <span class="n">Px</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="o">.</span><span class="n">Py</span> <span class="o">=</span> <span class="n">Py</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="o">.</span><span class="n">Pz</span> <span class="o">=</span> <span class="n">Pz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>

        <span class="c"># derivatives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dq_dU</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">U</span>
        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dq_dU</span><span class="o">*</span><span class="n">cd</span> <span class="o">+</span> <span class="n">q</span><span class="o">*</span><span class="n">dcd_dRe</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dU</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dU</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="n">cd</span> <span class="o">+</span> <span class="n">dcd_dRe</span><span class="o">*</span><span class="n">Re</span><span class="p">)</span><span class="o">*</span><span class="n">q</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cm</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dd</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dd</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cm</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.0</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dA</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dA</span> <span class="o">=</span> <span class="n">const</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;waveLoads.Px&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads.Py&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads.Pz&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads.q&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads.z&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads.beta&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

        <span class="n">zeron</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="n">dPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dU</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dA</span><span class="p">),</span> <span class="n">zeron</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dd</span><span class="p">)])</span>
        <span class="n">dPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dU</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dA</span><span class="p">),</span> <span class="n">zeron</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dd</span><span class="p">)])</span>
        <span class="n">dPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>
        <span class="n">dq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dq_dU</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">))])</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">zeron</span><span class="p">,</span> <span class="n">zeron</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">zeron</span><span class="p">])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dPx</span><span class="p">,</span> <span class="n">dPy</span><span class="p">,</span> <span class="n">dPz</span><span class="p">,</span> <span class="n">dq</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="p">))])</span>  <span class="c"># TODO: remove these zeros after OpenMDAO bug fix (don&#39;t need waveLoads.beta)</span>

        <span class="k">return</span> <span class="n">J</span>







<span class="k">class</span> <span class="nc">TowerDiscretization</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;discretize geometry into finite element nodes&quot;&quot;&quot;</span>

    <span class="c"># variables</span>
    <span class="n">towerHeight</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
    <span class="n">monopileHeight</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations along unit tower, linear lofting between&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tower diameter at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;shell thickness at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">d_monopile</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
    <span class="n">t_monopile</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of finite elements between sections.  array length should be ``len(z)-1``&#39;</span><span class="p">)</span>
    <span class="n">n_monopile</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;must be a minimum of 1 (top and bottom)&#39;</span><span class="p">)</span>
    <span class="n">L_reinforced</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>

    <span class="c"># out</span>
    <span class="n">z_node</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations along tower, linear lofting between&#39;</span><span class="p">)</span>
    <span class="n">d_node</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tower diameter at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">t_node</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;shell thickness at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">L_reinforced_node</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>


    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">n1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dznode_dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">))</span>

        <span class="c"># compute nodal locations (and gradients)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="n">nlast</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)):</span>
            <span class="n">znode</span><span class="p">,</span> <span class="n">dznode_dzi</span><span class="p">,</span> <span class="n">dznode_dzip</span> <span class="o">=</span> <span class="n">linspace_with_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">,</span> <span class="n">znode</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

            <span class="c"># gradients</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dznode_dz</span><span class="p">[</span><span class="n">nlast</span><span class="p">:</span><span class="n">nlast</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dznode_dzi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dznode_dz</span><span class="p">[</span><span class="n">nlast</span><span class="p">:</span><span class="n">nlast</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dznode_dzip</span>
            <span class="n">nlast</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>


        <span class="c"># interpolate (and gradients)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d_node</span><span class="p">,</span> <span class="n">ddnode_dznode</span><span class="p">,</span> <span class="n">ddnode_dz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddnode_dd</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_node</span><span class="p">,</span> <span class="n">dtnode_dznode</span><span class="p">,</span> <span class="n">dtnode_dz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtnode_dt</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

        <span class="c"># chain rule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddnode_dz</span> <span class="o">=</span> <span class="n">ddnode_dz</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ddnode_dznode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dznode_dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtnode_dz</span> <span class="o">=</span> <span class="n">dtnode_dz</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dtnode_dznode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dznode_dz</span><span class="p">)</span>

        <span class="c"># TODO: redo gradients for L_reinforced, although it probably won&#39;t ever change</span>

        <span class="c"># reinforcement distances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">)</span>

        <span class="c"># self.z_reinforced, dzr_dz0, dzr_dzend = linspace_with_deriv(self.z[0], self.z[-1], self.n_reinforced+1)</span>
        <span class="c"># self.dzr_dz = np.zeros((len(self.z_reinforced), n2))</span>
        <span class="c"># self.dzr_dz[:, 0] = dzr_dz0</span>
        <span class="c"># self.dzr_dz[:, -1] = dzr_dzend</span>

        <span class="c"># make dimensional</span>
        <span class="n">towerHt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">towerHeight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_node</span> <span class="o">*=</span> <span class="n">towerHt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dznode_dz</span> <span class="o">*=</span> <span class="n">towerHt</span>
        <span class="c"># self.z_reinforced *= towerHt</span>
        <span class="c"># self.dzr_dz *= towerHt</span>

        <span class="c"># TODO: redo gradients for monopile</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monopileHeight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_monopile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">monopileHeight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_monopile</span><span class="p">)</span>
            <span class="n">d_monopile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_monopile</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">z_monopile</span><span class="p">)</span>
            <span class="n">t_monopile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_monopile</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">z_monopile</span><span class="p">)</span>
            <span class="n">L_monopile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">z_monopile</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">z_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">z_monopile</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">d_monopile</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_node</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">t_monopile</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_node</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">L_monopile</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced_node</span><span class="p">])</span>
            <span class="c"># self.z_reinforced = np.concatenate([[z_monopile[0]], self.z_reinforced])</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;towerHeight&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;z_node&#39;</span><span class="p">,</span> <span class="s">&#39;d_node&#39;</span><span class="p">,</span> <span class="s">&#39;t_node&#39;</span><span class="p">)</span>  <span class="c"># , &#39;z_reinforced&#39;)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="c"># n2 = len(self.z_reinforced)</span>

        <span class="n">dzn</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">z_node</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">towerHeight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dznode_dz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">))])</span>
        <span class="n">ddn</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddnode_dz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddnode_dd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))])</span>
        <span class="n">dtn</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtnode_dz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtnode_dt</span><span class="p">])</span>
        <span class="c"># dzr = hstack([self.z_reinforced/self.towerHeight, self.dzr_dz, np.zeros((n2, 2*m))])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dzn</span><span class="p">,</span> <span class="n">ddn</span><span class="p">,</span> <span class="n">dtn</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>




<span class="k">class</span> <span class="nc">RNAMass</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">blades_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of all blade&#39;</span><span class="p">)</span>
    <span class="n">hub_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of hub&#39;</span><span class="p">)</span>
    <span class="n">nac_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of nacelle&#39;</span><span class="p">)</span>

    <span class="n">hub_cm</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of hub center of mass relative to tower top in yaw-aligned c.s.&#39;</span><span class="p">)</span>
    <span class="n">nac_cm</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of nacelle center of mass relative to tower top in yaw-aligned c.s.&#39;</span><span class="p">)</span>

    <span class="c"># TODO: check on this???</span>
    <span class="c"># order for all moments of inertia is (xx, yy, zz, xy, xz, yz) in the yaw-aligned coorinate system</span>
    <span class="n">blades_I</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of all blades about hub center&#39;</span><span class="p">)</span>
    <span class="n">hub_I</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of hub about its center of mass&#39;</span><span class="p">)</span>
    <span class="n">nac_I</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of nacelle about its center of mass&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">rna_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total mass of RNA&#39;</span><span class="p">)</span>
    <span class="n">rna_cm</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of RNA center of mass relative to tower top in yaw-aligned c.s.&#39;</span><span class="p">)</span>
    <span class="n">rna_I_TT</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of RNA about tower top in yaw-aligned coordinate system&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_assembleI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ixx</span><span class="p">,</span> <span class="n">Iyy</span><span class="p">,</span> <span class="n">Izz</span><span class="p">,</span> <span class="n">Ixy</span><span class="p">,</span> <span class="n">Ixz</span><span class="p">,</span> <span class="n">Iyz</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Ixx</span><span class="p">,</span> <span class="n">Ixy</span><span class="p">,</span> <span class="n">Ixz</span><span class="p">],</span> <span class="p">[</span><span class="n">Ixy</span><span class="p">,</span> <span class="n">Iyy</span><span class="p">,</span> <span class="n">Iyz</span><span class="p">],</span> <span class="p">[</span><span class="n">Ixz</span><span class="p">,</span> <span class="n">Iyz</span><span class="p">,</span> <span class="n">Izz</span><span class="p">]])</span>


    <span class="k">def</span> <span class="nf">_unassembleI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blades_mass</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hub_mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span>

        <span class="c"># rna mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span>

        <span class="c"># rna cm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rna_cm</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hub_cm</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nac_cm</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span>

        <span class="c"># rna I</span>
        <span class="n">blades_I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assembleI</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">blades_I</span><span class="p">)</span>
        <span class="n">hub_I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assembleI</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hub_I</span><span class="p">)</span>
        <span class="n">nac_I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assembleI</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nac_I</span><span class="p">)</span>
        <span class="n">rotor_I</span> <span class="o">=</span> <span class="n">blades_I</span> <span class="o">+</span> <span class="n">hub_I</span>

        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hub_cm</span>
        <span class="n">rotor_I_TT</span> <span class="o">=</span> <span class="n">rotor_I</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>

        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_cm</span>
        <span class="n">nac_I_TT</span> <span class="o">=</span> <span class="n">nac_I</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rna_I_TT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="n">rotor_I_TT</span> <span class="o">+</span> <span class="n">nac_I_TT</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;blades_mass&#39;</span><span class="p">,</span> <span class="s">&#39;hub_mass&#39;</span><span class="p">,</span> <span class="s">&#39;nac_mass&#39;</span><span class="p">,</span> <span class="s">&#39;hub_cm&#39;</span><span class="p">,</span> <span class="s">&#39;nac_cm&#39;</span><span class="p">,</span> <span class="s">&#39;blades_I&#39;</span><span class="p">,</span> <span class="s">&#39;hub_I&#39;</span><span class="p">,</span> <span class="s">&#39;nac_I&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;rna_mass&#39;</span><span class="p">,</span> <span class="s">&#39;rna_cm&#39;</span><span class="p">,</span> <span class="s">&#39;rna_I_TT&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># mass</span>
        <span class="n">dmass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="mi">6</span><span class="p">)])</span>

        <span class="c"># cm</span>
        <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hub_cm</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nac_cm</span><span class="p">)</span>
        <span class="n">dcm_dblademass</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hub_cm</span> <span class="o">-</span> <span class="n">top</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dcm_dhubmass</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hub_cm</span> <span class="o">-</span> <span class="n">top</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dcm_dnacmass</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nac_cm</span> <span class="o">-</span> <span class="n">top</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dcm_dhubcm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">dcm_dnaccm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_mass</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">dcm</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dcm_dblademass</span><span class="p">,</span> <span class="n">dcm_dhubmass</span><span class="p">,</span> <span class="n">dcm_dnacmass</span><span class="p">,</span> <span class="n">dcm_dhubcm</span><span class="p">,</span>
            <span class="n">dcm_dnaccm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mi">6</span><span class="p">))])</span>

        <span class="c"># I</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hub_cm</span>
        <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
        <span class="n">dI_dblademass</span> <span class="o">=</span> <span class="n">const</span>
        <span class="n">dI_dhubmass</span> <span class="o">=</span> <span class="n">const</span>
        <span class="n">dI_drx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]))</span>
        <span class="n">dI_dry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">]]))</span>
        <span class="n">dI_drz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotor_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]))</span>
        <span class="n">dI_dhubcm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dI_drx</span><span class="p">,</span> <span class="n">dI_dry</span><span class="p">,</span> <span class="n">dI_drz</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_cm</span>
        <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
        <span class="n">dI_dnacmass</span> <span class="o">=</span> <span class="n">const</span>
        <span class="n">dI_drx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]))</span>
        <span class="n">dI_dry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">]]))</span>
        <span class="n">dI_drz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nac_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_unassembleI</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]))</span>
        <span class="n">dI_dnaccm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dI_drx</span><span class="p">,</span> <span class="n">dI_dry</span><span class="p">,</span> <span class="n">dI_drz</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dI_dbladeI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">dI_dhubI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">dI_dnacI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

        <span class="n">dI</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dI_dblademass</span><span class="p">,</span> <span class="n">dI_dhubmass</span><span class="p">,</span> <span class="n">dI_dnacmass</span><span class="p">,</span> <span class="n">dI_dhubcm</span><span class="p">,</span> <span class="n">dI_dnaccm</span><span class="p">,</span>
            <span class="n">dI_dbladeI</span><span class="p">,</span> <span class="n">dI_dhubI</span><span class="p">,</span> <span class="n">dI_dnacI</span><span class="p">])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dmass</span><span class="p">,</span> <span class="n">dcm</span><span class="p">,</span> <span class="n">dI</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>






<span class="k">class</span> <span class="nc">RotorLoads</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;forces in hub-aligned coordinate system&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;moments in hub-aligned coordinate system&#39;</span><span class="p">)</span>
    <span class="n">r_hub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;position of rotor hub relative to tower top in yaw-aligned c.s.&#39;</span><span class="p">)</span>
    <span class="n">m_RNA</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of rotor nacelle assembly&#39;</span><span class="p">)</span>
    <span class="n">rna_cm</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of RNA center of mass relative to tower top in yaw-aligned c.s.&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">downwind</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s**2&#39;</span><span class="p">)</span>

    <span class="c"># out</span>
    <span class="n">top_F</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>  <span class="c"># in yaw-aligned</span>
    <span class="n">top_M</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>

    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>

        <span class="c"># change x-direction if downwind</span>
        <span class="n">r_hub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_hub</span><span class="p">)</span>
        <span class="n">rna_cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_cm</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">downwind</span><span class="p">:</span>
            <span class="n">r_hub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">rna_cm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">r_hub</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="n">r_hub</span><span class="p">)</span>
        <span class="n">rna_cm</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="n">rna_cm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_rhub</span> <span class="o">=</span> <span class="n">r_hub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_rcm</span> <span class="o">=</span> <span class="n">rna_cm</span>

        <span class="c"># aerodynamic moments</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="n">r_hub</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveF</span> <span class="o">=</span> <span class="n">F</span>

        <span class="c"># add weight loads</span>
        <span class="n">F_w</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_RNA</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
        <span class="n">M_w</span> <span class="o">=</span> <span class="n">rna_cm</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">F_w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveF_w</span> <span class="o">=</span> <span class="n">F_w</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">F</span> <span class="o">+</span> <span class="n">F_w</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="n">M_w</span>

        <span class="c"># put back in array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">F</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="s">&#39;r_hub&#39;</span><span class="p">,</span> <span class="s">&#39;m_RNA&#39;</span><span class="p">,</span> <span class="s">&#39;rna_cm&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;top_F&#39;</span><span class="p">,</span> <span class="s">&#39;top_M&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dF</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>
        <span class="n">dFx</span><span class="p">,</span> <span class="n">dFy</span><span class="p">,</span> <span class="n">dFz</span> <span class="o">=</span> <span class="n">dF</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">dF</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">dF</span><span class="o">.</span><span class="n">dz</span>

        <span class="n">dtopF_dFx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dFx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">],</span> <span class="n">dFy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">],</span> <span class="n">dFz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]])</span>
        <span class="n">dtopF_dFy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dFx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">],</span> <span class="n">dFy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">],</span> <span class="n">dFz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]])</span>
        <span class="n">dtopF_dFz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dFx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">],</span> <span class="n">dFy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">],</span> <span class="n">dFz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]])</span>
        <span class="n">dtopF_dF</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dtopF_dFx</span><span class="p">,</span> <span class="n">dtopF_dFy</span><span class="p">,</span> <span class="n">dtopF_dFz</span><span class="p">])</span>
        <span class="n">dtopF_w_dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">])</span>

        <span class="n">dtopF</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dtopF_dF</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span> <span class="n">dtopF_w_dm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))])</span>


        <span class="n">dM</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="o">.</span><span class="n">fromArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>
        <span class="n">dMx</span><span class="p">,</span> <span class="n">dMy</span><span class="p">,</span> <span class="n">dMz</span> <span class="o">=</span> <span class="n">dM</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">dM</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">dM</span><span class="o">.</span><span class="n">dz</span>
        <span class="n">dMxcross</span><span class="p">,</span> <span class="n">dMycross</span><span class="p">,</span> <span class="n">dMzcross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_rhub</span><span class="o">.</span><span class="n">cross_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveF</span><span class="p">,</span> <span class="s">&#39;dr&#39;</span><span class="p">,</span> <span class="s">&#39;dF&#39;</span><span class="p">)</span>

        <span class="n">dtopM_dMx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dMx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">],</span> <span class="n">dMy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">],</span> <span class="n">dMz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]])</span>
        <span class="n">dtopM_dMy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dMx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">],</span> <span class="n">dMy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">],</span> <span class="n">dMz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]])</span>
        <span class="n">dtopM_dMz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dMx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">],</span> <span class="n">dMy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">],</span> <span class="n">dMz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]])</span>
        <span class="n">dtopM_dM</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dtopM_dMx</span><span class="p">,</span> <span class="n">dtopM_dMy</span><span class="p">,</span> <span class="n">dtopM_dMz</span><span class="p">])</span>
        <span class="n">dM_dF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dMxcross</span><span class="p">[</span><span class="s">&#39;dF&#39;</span><span class="p">],</span> <span class="n">dMycross</span><span class="p">[</span><span class="s">&#39;dF&#39;</span><span class="p">],</span> <span class="n">dMzcross</span><span class="p">[</span><span class="s">&#39;dF&#39;</span><span class="p">]])</span>

        <span class="n">dtopM_dFx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dM_dF</span><span class="p">,</span> <span class="n">dtopF_dFx</span><span class="p">)</span>
        <span class="n">dtopM_dFy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dM_dF</span><span class="p">,</span> <span class="n">dtopF_dFy</span><span class="p">)</span>
        <span class="n">dtopM_dFz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dM_dF</span><span class="p">,</span> <span class="n">dtopF_dFz</span><span class="p">)</span>
        <span class="n">dtopM_dF</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dtopM_dFx</span><span class="p">,</span> <span class="n">dtopM_dFy</span><span class="p">,</span> <span class="n">dtopM_dFz</span><span class="p">])</span>
        <span class="n">dtopM_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dMxcross</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">],</span> <span class="n">dMycross</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">],</span> <span class="n">dMzcross</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">]])</span>

        <span class="n">dMx_w_cross</span><span class="p">,</span> <span class="n">dMy_w_cross</span><span class="p">,</span> <span class="n">dMz_w_cross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_rcm</span><span class="o">.</span><span class="n">cross_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveF_w</span><span class="p">,</span> <span class="s">&#39;dr&#39;</span><span class="p">,</span> <span class="s">&#39;dF&#39;</span><span class="p">)</span>

        <span class="n">dtopM_drnacm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dMx_w_cross</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">],</span> <span class="n">dMy_w_cross</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">],</span> <span class="n">dMz_w_cross</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">]])</span>
        <span class="n">dtopM_dF_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dMx_w_cross</span><span class="p">[</span><span class="s">&#39;dF&#39;</span><span class="p">],</span> <span class="n">dMy_w_cross</span><span class="p">[</span><span class="s">&#39;dF&#39;</span><span class="p">],</span> <span class="n">dMz_w_cross</span><span class="p">[</span><span class="s">&#39;dF&#39;</span><span class="p">]])</span>
        <span class="n">dtopM_dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dtopM_dF_w</span><span class="p">,</span> <span class="n">dtopF_w_dm</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">downwind</span><span class="p">:</span>
            <span class="n">dtopM_dr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">dtopM_drnacm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">dtopM</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dtopM_dF</span><span class="p">,</span> <span class="n">dtopM_dM</span><span class="p">,</span> <span class="n">dtopM_dr</span><span class="p">,</span> <span class="n">dtopM_dm</span><span class="p">,</span> <span class="n">dtopM_drnacm</span><span class="p">])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">dtopF</span><span class="p">,</span> <span class="n">dtopM</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>



<span class="k">class</span> <span class="nc">GeometricConstraints</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for OtherConstraints&quot;&quot;&quot;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">min_d_to_t</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">120.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">min_taper</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>

    <span class="n">weldability</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>
    <span class="n">manufactuability</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weldability</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_d_to_t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_d_to_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manufactuability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_taper</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># taper ratio</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;weldability&#39;</span><span class="p">,</span> <span class="s">&#39;manufactuability&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dw_dd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">min_d_to_t</span><span class="p">)</span>
        <span class="n">dw_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">min_d_to_t</span><span class="p">)</span>

        <span class="n">dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">dw_dd</span><span class="p">,</span> <span class="n">dw_dt</span><span class="p">])</span>


        <span class="n">dm_dd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="n">dm_dd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dm_dd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">dm_dd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">))])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">dw</span><span class="p">,</span> <span class="n">dm</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>



<div class="viewcode-block" id="TowerBase"><a class="viewcode-back" href="../../documentation.html#towerse.tower.TowerBase">[docs]</a><span class="k">class</span> <span class="nc">TowerBase</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;structural analysis of cylindrical tower</span>

<span class="sd">    all forces, moments, distances should be given (and returned) in the yaw-aligned coordinate system</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># geometry</span>
    <span class="n">towerHeight</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations along unit tower&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tower diameter at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;shell thickness at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">L_reinforced</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;reinforcement positions for buckling&#39;</span><span class="p">)</span>
    <span class="n">yaw</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">)</span>

    <span class="c"># wind/wave loads</span>
    <span class="n">windLoads</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">AeroLoads</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">waveLoads</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">AeroLoads</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s**2&#39;</span><span class="p">)</span>

    <span class="c"># top mass</span>
    <span class="n">top_F</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">top_M</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">top_m</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">top_I</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia. order: (xx, yy, zz, xy, xz, yz)&#39;</span><span class="p">)</span>
    <span class="n">top_cm</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>

    <span class="c"># soil</span>
    <span class="n">k_soil</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;stiffness properties at base of foundation&#39;</span><span class="p">)</span>

    <span class="c"># material properties</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">210e9</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;material modulus of elasticity&#39;</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">80.8e9</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;material shear modulus&#39;</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">8500.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;material density&#39;</span><span class="p">)</span>
    <span class="n">sigma_y</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">450.0e6</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;yield stress&#39;</span><span class="p">)</span>

    <span class="c"># safety factors</span>
    <span class="n">gamma_f</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.35</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor on loads&#39;</span><span class="p">)</span>
    <span class="n">gamma_m</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor on materials&#39;</span><span class="p">)</span>
    <span class="n">gamma_n</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor on consequence of failure&#39;</span><span class="p">)</span>
    <span class="n">gamma_b</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;buckling safety factor&#39;</span><span class="p">)</span>

    <span class="n">life</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue life of tower&#39;</span><span class="p">)</span>
    <span class="n">m_SN</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;slope of S/N curve&#39;</span><span class="p">)</span>
    <span class="n">DC</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;standard value of stress&#39;</span><span class="p">)</span>
    <span class="n">gamma_fatigue</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.755</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total safety factor for fatigue&#39;</span><span class="p">)</span>
    <span class="n">z_DEL</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">M_DEL</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first natural frequency&#39;</span><span class="p">)</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;second natural frequency&#39;</span><span class="p">)</span>
    <span class="n">top_deflection</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of tower top in yaw-aligned +x direction&#39;</span><span class="p">)</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;von Mises stress along tower on downwind side (yaw-aligned +x).  normalized by yield stress.  includes safety factors.&#39;</span><span class="p">)</span>
    <span class="c"># z_buckling = Array(iotype=&#39;out&#39;, units=&#39;m&#39;, desc=&#39;z-locations along tower where shell buckling is evaluted&#39;)</span>
    <span class="n">shellBuckling</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a shell buckling constraint.  should be &lt;= 0 for feasibility.  includes safety factors&#39;</span><span class="p">)</span>
    <span class="n">buckling</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a global buckling constraint.  should be &lt;= 0 for feasibility.  includes safety factors&#39;</span><span class="p">)</span>
    <span class="n">damage</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage at each tower section&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">aerohydroLoadsAtNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;rotate wind loads to yaw c.s. and interpolate onto nodes&quot;&quot;&quot;</span>

        <span class="c"># aero/hydro loads</span>
        <span class="n">wind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span>
        <span class="n">hubHt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># top of tower</span>
        <span class="n">betaMain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">hubHt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">wind</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>  <span class="c"># wind coordinate system defined relative to hub height</span>
        <span class="n">windLoads</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">wind</span><span class="o">.</span><span class="n">Px</span><span class="p">,</span> <span class="n">wind</span><span class="o">.</span><span class="n">Py</span><span class="p">,</span> <span class="n">wind</span><span class="o">.</span><span class="n">Pz</span><span class="p">)</span><span class="o">.</span><span class="n">inertialToWind</span><span class="p">(</span><span class="n">betaMain</span><span class="p">)</span><span class="o">.</span><span class="n">windToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">)</span>
        <span class="n">waveLoads</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">Px</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">Py</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">Pz</span><span class="p">)</span><span class="o">.</span><span class="n">inertialToWind</span><span class="p">(</span><span class="n">betaMain</span><span class="p">)</span><span class="o">.</span><span class="n">windToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">)</span>

        <span class="n">Px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">wind</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">windLoads</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">waveLoads</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">wind</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">windLoads</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">waveLoads</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">Pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">wind</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">windLoads</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">waveLoads</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span>




    <span class="k">def</span> <span class="nf">fatigue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;compute damage from provided damage equivalent moments&quot;&quot;&quot;</span>

        <span class="c"># TODO: temporary hack to extract tower portion</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c"># fatigue</span>
        <span class="n">N_DEL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">life</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">M_DEL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">towerHeight</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">z_DEL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_DEL</span><span class="p">)</span>

        <span class="n">damage</span> <span class="o">=</span> <span class="n">fatigue</span><span class="p">(</span><span class="n">M_DEL</span><span class="p">,</span> <span class="n">N_DEL</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_SN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_fatigue</span><span class="p">,</span> <span class="n">stress_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">weld_factor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># TODO: more hack</span>
        <span class="n">damage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">damage</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">damage</span>


</div>
<div class="viewcode-block" id="TowerWithpBEAM"><a class="viewcode-back" href="../../documentation.html#towerse.tower.TowerWithpBEAM">[docs]</a><span class="k">class</span> <span class="nc">TowerWithpBEAM</span><span class="p">(</span><span class="n">TowerBase</span><span class="p">):</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">_pBEAM</span>  <span class="c"># import only if instantiated so that Frame3DD is not required for all users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pBEAM</span> <span class="o">=</span> <span class="n">_pBEAM</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TowerWithpBEAM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">_pBEAM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pBEAM</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>


        <span class="c"># aero/hydro loads</span>
        <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aerohydroLoadsAtNodes</span><span class="p">()</span>

        <span class="c"># add weight loads</span>
        <span class="n">Pz_weight</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">t</span>
        <span class="n">Pz</span> <span class="o">+=</span> <span class="n">Pz_weight</span>

        <span class="c"># pBEAM loads object</span>
        <span class="n">loads</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Loads</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">)</span>

        <span class="c"># material properties</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>

        <span class="c"># RNA properties</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">TipData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_cm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_F</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_M</span><span class="p">)</span>

        <span class="c"># soil</span>
        <span class="n">soil</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">BaseData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_soil</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">))</span>

        <span class="c"># tower object</span>
        <span class="n">tower</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Beam</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">loads</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">soil</span><span class="p">)</span>

        <span class="c"># mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">tower</span><span class="o">.</span><span class="n">mass</span><span class="p">()</span>

        <span class="c"># natural frequncies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f2</span> <span class="o">=</span> <span class="n">tower</span><span class="o">.</span><span class="n">naturalFrequencies</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c"># deflections due to loading from tower top and wind/wave loads</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">dthetax</span><span class="p">,</span> <span class="n">dthetay</span><span class="p">,</span> <span class="n">dthetaz</span> <span class="o">=</span> <span class="n">tower</span><span class="o">.</span><span class="n">displacement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_deflection</span> <span class="o">=</span> <span class="n">dx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># in yaw-aligned direction</span>

        <span class="c"># axial stress (all stress evaluated on +x yaw side)</span>
        <span class="n">axial_stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">*</span><span class="n">tower</span><span class="o">.</span><span class="n">axialStrain</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">d</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

        <span class="c"># shear stress</span>
        <span class="n">Vx</span><span class="p">,</span> <span class="n">Vy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">Tz</span> <span class="o">=</span> <span class="n">tower</span><span class="o">.</span><span class="n">shearAndBending</span><span class="p">()</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">shear_stress</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">/</span> <span class="n">A</span>

        <span class="c"># I = math.pi/8 * d**3 * t</span>
        <span class="c"># axial_stress2 = -My*d/2.0/I + Fz/A</span>

        <span class="c"># hoop_stress (Eurocode method)</span>
        <span class="n">hoop_stress</span> <span class="o">=</span> <span class="n">hoopStressEurocode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced</span><span class="p">)</span>

        <span class="c"># von mises stress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="n">vonMisesStressUtilization</span><span class="p">(</span><span class="n">axial_stress</span><span class="p">,</span> <span class="n">hoop_stress</span><span class="p">,</span> <span class="n">shear_stress</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_y</span><span class="p">)</span>

        <span class="c"># buckling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shellBuckling</span> <span class="o">=</span> <span class="n">shellBucklingEurocode</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">axial_stress</span><span class="p">,</span> <span class="n">hoop_stress</span><span class="p">,</span> <span class="n">shear_stress</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_b</span><span class="p">)</span>

        <span class="n">tower_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buckling</span> <span class="o">=</span> <span class="n">bucklingGL</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">tower_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_b</span><span class="p">)</span>

        <span class="c"># fatigue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fatigue</span><span class="p">()</span>


    <span class="c"># def list_deriv_vars(self):</span>

    <span class="c">#     inputs = (&#39;z&#39;, &#39;d&#39;, &#39;t&#39;)</span>
    <span class="c">#     outputs = (&#39;mass&#39;,)</span>

    <span class="c">#     return inputs, outputs</span>


    <span class="c"># def provideJ(self):</span>

    <span class="c">#     # m = 0.0</span>
    <span class="c">#     # for i in range(nodes - 1):</span>
    <span class="c">#     #     m += (z[i+1]-z[i]) * (1.0/3*(d[i]*t[i] + d[i+1]*t[i+1]) + 1.0/6*(d[i]*t[i+1] + d[i+1]*t[i]))</span>
    <span class="c">#     # m *= self.rho * pi</span>

    <span class="c">#     z = self.z</span>
    <span class="c">#     d = self.d</span>
    <span class="c">#     t = self.t</span>

    <span class="c">#     n = len(z)</span>
    <span class="c">#     dmass_dz = np.zeros(n)</span>
    <span class="c">#     dmass_dd = np.zeros(n)</span>
    <span class="c">#     dmass_dt = np.zeros(n)</span>

    <span class="c">#     for i in range(n - 1):</span>
    <span class="c">#         factor = 1.0/3*(d[i]*t[i] + d[i+1]*t[i+1]) + 1.0/6*(d[i]*t[i+1] + d[i+1]*t[i])</span>
    <span class="c">#         dmass_dz[i] = -factor</span>
    <span class="c">#         dmass_dz[i+1] = factor</span>
    <span class="c">#         dmass_dd[i] = (z[i+1]-z[i]) * (1.0/3*t[i] + 1.0/6*t[i+1])</span>
    <span class="c">#         dmass_dd[i+1] = (z[i+1]-z[i]) * (1.0/3*t[i+1] + 1.0/6*t[i])</span>
    <span class="c">#         dmass_dt[i] = (z[i+1]-z[i]) * (1.0/3*d[i] + 1.0/6*d[i+1])</span>
    <span class="c">#         dmass_dt[i+1] = (z[i+1]-z[i]) * (1.0/3*d[i+1] + 1.0/6*d[i])</span>

    <span class="c">#     dmass = self.rho * pi * hstack([dmass_dz, dmass_dd, dmass_dt])</span>


    <span class="c">#     # Vx = np.zeros(nodes)</span>
    <span class="c">#     # Vy = np.zeros(nodes)</span>
    <span class="c">#     # Fz = np.zeros(nodes)</span>
    <span class="c">#     # Mx = np.zeros(nodes)</span>
    <span class="c">#     # My = np.zeros(nodes)</span>
    <span class="c">#     # Tz = np.zeros(nodes)</span>
    <span class="c">#     # Vx[-1] = self.top_F[0]</span>
    <span class="c">#     # Vy[-1] = self.top_F[1]</span>
    <span class="c">#     # Fz[-1] = self.top_F[2]</span>
    <span class="c">#     # Mx[-1] = self.top_M[0]</span>
    <span class="c">#     # My[-1] = self.top_M[1]</span>
    <span class="c">#     # Tz[-1] = self.top_M[2]</span>
    <span class="c">#     # for i in reversed(range(nodes-1)):</span>
    <span class="c">#     #     Vx[i] = Vx[i+1] + 0.5*(Px[i] + Px[i+1])*(z[i+1]-z[i])</span>
    <span class="c">#     #     Vy[i] = Vy[i+1] + 0.5*(Py[i] + Py[i+1])*(z[i+1]-z[i])</span>
    <span class="c">#     #     Fz[i] = Fz[i+1] + 0.5*(Pz[i] + Pz[i+1])*(z[i+1]-z[i])</span>

    <span class="c">#     #     Mx[i] = Mx[i+1] + Vy[i+1]*(z[i+1]-z[i]) + (Py[i]/6.0 + Py[i+1]/3.0)*(z[i+1]-z[i])**2</span>
    <span class="c">#     #     My[i] = My[i+1] + Vx[i+1]*(z[i+1]-z[i]) + (Px[i]/6.0 + Px[i+1]/3.0)*(z[i+1]-z[i])**2</span>
    <span class="c">#     #     Tz[i] = Tz[i+1]</span>

    <span class="c">#     J = vstack([dmass])</span>

    <span class="c">#     return J</span>

</div>
<div class="viewcode-block" id="TowerWithFrame3DD"><a class="viewcode-back" href="../../documentation.html#towerse.tower.TowerWithFrame3DD">[docs]</a><span class="k">class</span> <span class="nc">TowerWithFrame3DD</span><span class="p">(</span><span class="n">TowerBase</span><span class="p">):</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">frame3dd</span>  <span class="c"># import only if instantiated so that Frame3DD is not required for all users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame3dd</span> <span class="o">=</span> <span class="n">frame3dd</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TowerWithFrame3DD</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">frame3dd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame3dd</span>

        <span class="c"># ------- node data ----------------</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">NodeData</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="c"># -----------------------------------</span>

        <span class="c"># ------ reaction data ------------</span>

        <span class="c"># rigid base</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Kx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_soil</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_soil</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">Kz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_soil</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">Ktx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_soil</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Kty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_soil</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">Ktz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_soil</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">rigid</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">)</span>

        <span class="n">reactions</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">ReactionData</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Kx</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span><span class="p">,</span> <span class="n">Ktx</span><span class="p">,</span> <span class="n">Kty</span><span class="p">,</span> <span class="n">Ktz</span><span class="p">,</span> <span class="n">rigid</span><span class="p">)</span>
        <span class="c"># -----------------------------------</span>


        <span class="c"># ------ frame element data ------------</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.0</span>  <span class="c"># average for element with constant properties</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.0</span>  <span class="c"># average for element with constant properties</span>
        <span class="n">ro</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">t</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">t</span><span class="o">/</span><span class="mf">2.0</span>

        <span class="n">element</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Ax</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">ro</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">ri</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Asy</span> <span class="o">=</span> <span class="n">Ax</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.54414</span> <span class="o">+</span> <span class="mf">2.97294</span><span class="o">*</span><span class="p">(</span><span class="n">ri</span><span class="o">/</span><span class="n">ro</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.51899</span><span class="o">*</span><span class="p">(</span><span class="n">ri</span><span class="o">/</span><span class="n">ro</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Asz</span> <span class="o">=</span> <span class="n">Ax</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.54414</span> <span class="o">+</span> <span class="mf">2.97294</span><span class="o">*</span><span class="p">(</span><span class="n">ri</span><span class="o">/</span><span class="n">ro</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.51899</span><span class="o">*</span><span class="p">(</span><span class="n">ri</span><span class="o">/</span><span class="n">ro</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Jx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ro</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">ri</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">Iy</span> <span class="o">=</span> <span class="n">Jx</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">Iz</span> <span class="o">=</span> <span class="n">Jx</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">ElementData</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">Ax</span><span class="p">,</span> <span class="n">Asy</span><span class="p">,</span> <span class="n">Asz</span><span class="p">,</span> <span class="n">Jx</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>

        <span class="c"># -----------------------------------</span>


        <span class="c"># ------ options ------------</span>

        <span class="n">shear</span> <span class="o">=</span> <span class="bp">True</span>        <span class="c"># 1: include shear deformation</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="bp">False</span>        <span class="c"># 1: include geometric stiffness</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">10.0</span>           <span class="c"># x-axis increment for internal forces</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">Options</span><span class="p">(</span><span class="n">shear</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>

        <span class="c"># -----------------------------------</span>

        <span class="c"># initialize frame3dd object</span>
        <span class="n">tower</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>


        <span class="c"># ------ add extra mass ------------</span>

        <span class="c"># extra node inertia data</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="p">])</span>
        <span class="n">EMs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_m</span><span class="p">])</span>
        <span class="n">EMx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_I</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">EMy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_I</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">EMz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_I</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">EMxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_I</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
        <span class="n">EMxz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_I</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
        <span class="n">EMyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_I</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
        <span class="n">rhox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_cm</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">rhoy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_cm</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">rhoz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_cm</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">addGravityLoad</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">tower</span><span class="o">.</span><span class="n">changeExtraNodeMass</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">EMs</span><span class="p">,</span> <span class="n">EMx</span><span class="p">,</span> <span class="n">EMy</span><span class="p">,</span> <span class="n">EMz</span><span class="p">,</span> <span class="n">EMxy</span><span class="p">,</span> <span class="n">EMxz</span><span class="p">,</span> <span class="n">EMyz</span><span class="p">,</span> <span class="n">rhox</span><span class="p">,</span> <span class="n">rhoy</span><span class="p">,</span> <span class="n">rhoz</span><span class="p">,</span> <span class="n">addGravityLoad</span><span class="p">)</span>
        <span class="c"># ------------------------------------</span>

        <span class="c"># ------- enable dynamic analysis ----------</span>

        <span class="n">nM</span> <span class="o">=</span> <span class="mi">2</span>              <span class="c"># number of desired dynamic modes of vibration (below only necessary if nM &gt; 0)</span>
        <span class="n">Mmethod</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c"># 1: subspace Jacobi     2: Stodola</span>
        <span class="n">lump</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c"># 0: consistent mass ... 1: lumped mass matrix</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-9</span>          <span class="c"># mode shape tolerance</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="mf">0.0</span>         <span class="c"># shift value ... for unrestrained structures</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">enableDynamics</span><span class="p">(</span><span class="n">nM</span><span class="p">,</span> <span class="n">Mmethod</span><span class="p">,</span> <span class="n">lump</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span>

        <span class="c"># ----------------------------</span>


        <span class="c"># ------ static load case 1 ------------</span>

        <span class="c"># gravity in the X, Y, Z, directions (global)</span>
        <span class="n">gx</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">gy</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">gz</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span>

        <span class="n">load</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">StaticLoadCase</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">)</span>

        <span class="c"># tower top load  (TODO: remove RNA weight from these forces since Frame3DD accounts for it)</span>

        <span class="n">nF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="p">])</span>
        <span class="n">Fx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_F</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">Fy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_F</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_F</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">Mxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_M</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">Myy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_M</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">Mzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">top_M</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

        <span class="n">load</span><span class="o">.</span><span class="n">changePointLoads</span><span class="p">(</span><span class="n">nF</span><span class="p">,</span> <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">Mxx</span><span class="p">,</span> <span class="n">Myy</span><span class="p">,</span> <span class="n">Mzz</span><span class="p">)</span>


        <span class="c"># aero/hydro loads</span>
        <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aerohydroLoadsAtNodes</span><span class="p">()</span>

        <span class="c"># switch to local c.s.</span>
        <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span> <span class="o">=</span> <span class="n">Pz</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="o">-</span><span class="n">Px</span>

        <span class="c"># trapezoidally distributed loads</span>
        <span class="n">EL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">xx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xx2</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1e-6</span>
        <span class="n">wx1</span> <span class="o">=</span> <span class="n">Px</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">wx2</span> <span class="o">=</span> <span class="n">Px</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">xy1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xy2</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1e-6</span>
        <span class="n">wy1</span> <span class="o">=</span> <span class="n">Py</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">wy2</span> <span class="o">=</span> <span class="n">Py</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">xz1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xz2</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1e-6</span>
        <span class="n">wz1</span> <span class="o">=</span> <span class="n">Pz</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">wz2</span> <span class="o">=</span> <span class="n">Pz</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">load</span><span class="o">.</span><span class="n">changeTrapezoidalLoads</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">xx1</span><span class="p">,</span> <span class="n">xx2</span><span class="p">,</span> <span class="n">wx1</span><span class="p">,</span> <span class="n">wx2</span><span class="p">,</span> <span class="n">xy1</span><span class="p">,</span> <span class="n">xy2</span><span class="p">,</span> <span class="n">wy1</span><span class="p">,</span> <span class="n">wy2</span><span class="p">,</span> <span class="n">xz1</span><span class="p">,</span> <span class="n">xz2</span><span class="p">,</span> <span class="n">wz1</span><span class="p">,</span> <span class="n">wz2</span><span class="p">)</span>


        <span class="n">tower</span><span class="o">.</span><span class="n">addLoadCase</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>

        <span class="c"># -----------------------------------</span>



        <span class="c"># run the analysis</span>
        <span class="n">displacements</span><span class="p">,</span> <span class="n">forces</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">internalForces</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">modal</span> <span class="o">=</span> <span class="n">tower</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">iCase</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">struct_mass</span>

        <span class="c"># natural frequncies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2</span> <span class="o">=</span> <span class="n">modal</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># deflections due to loading from tower top and wind/wave loads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_deflection</span> <span class="o">=</span> <span class="n">displacements</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># in yaw-aligned direction</span>


        <span class="c"># shear and bending (convert from local to global c.s.)</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Nx</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c"># Vy = forces.Vy[iCase, :]</span>
        <span class="n">Vx</span> <span class="o">=</span> <span class="o">-</span><span class="n">forces</span><span class="o">.</span><span class="n">Vz</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c"># Tzz = forces.Txx[iCase, :]</span>
        <span class="n">Myy</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Myy</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c"># Mxx = -forces.Mzz[iCase, :]</span>


        <span class="c"># one per element (first negative b.c. need reaction)</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="o">-</span><span class="n">Fz</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Fz</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">Vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="o">-</span><span class="n">Vx</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Vx</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">Myy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="o">-</span><span class="n">Myy</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Myy</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]])</span>


        <span class="c"># axial and shear stress (all stress evaluated on +x yaw side)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">Iyy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">8.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">axial_stress</span> <span class="o">=</span> <span class="n">Fz</span><span class="o">/</span><span class="n">A</span> <span class="o">-</span> <span class="n">Myy</span><span class="o">/</span><span class="n">Iyy</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">shear_stress</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">/</span> <span class="n">A</span>

        <span class="c"># hoop_stress (Eurocode method)</span>
        <span class="n">hoop_stress</span> <span class="o">=</span> <span class="n">hoopStressEurocode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windLoads</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveLoads</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_reinforced</span><span class="p">)</span>

        <span class="c"># von mises stress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="n">vonMisesStressUtilization</span><span class="p">(</span><span class="n">axial_stress</span><span class="p">,</span> <span class="n">hoop_stress</span><span class="p">,</span> <span class="n">shear_stress</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_y</span><span class="p">)</span>

        <span class="c"># buckling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buckling</span> <span class="o">=</span> <span class="n">shellBucklingEurocode</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">axial_stress</span><span class="p">,</span> <span class="n">hoop_stress</span><span class="p">,</span> <span class="n">shear_stress</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_reinforced</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_b</span><span class="p">)</span>

        <span class="c"># fatigue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fatigue</span><span class="p">()</span>





<span class="c"># -----------------</span>
<span class="c">#  Assembly</span>
<span class="c"># -----------------</span>

</div>
<div class="viewcode-block" id="TowerSE"><a class="viewcode-back" href="../../documentation.html#towerse.tower.TowerSE">[docs]</a><span class="k">class</span> <span class="nc">TowerSE</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>

    <span class="c"># geometry</span>
    <span class="n">towerHeight</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;height of tower&#39;</span><span class="p">)</span>
    <span class="n">monopileHeight</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;height of monopile (0.0 if no monopile)&#39;</span><span class="p">)</span>
    <span class="n">d_monopile</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;diameter of monopile&#39;</span><span class="p">)</span>
    <span class="n">t_monopile</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;wall thickness of monopile&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations along unit tower, linear lofting between&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tower diameter at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;shell thickness at corresponding locations&#39;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of finite elements between sections.  array length should be ``len(z)-1``&#39;</span><span class="p">)</span>
    <span class="n">L_reinforced</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distance along tower for reinforcements used in buckling calc&#39;</span><span class="p">)</span>
    <span class="n">n_monopile</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of finite elements in monopile, must be a minimum of 1 (top and bottom nodes)&#39;</span><span class="p">)</span>
    <span class="n">yaw</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;yaw angle&#39;</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tilt angle&#39;</span><span class="p">)</span>
    <span class="n">downwind</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;flag if rotor is downwind&#39;</span><span class="p">)</span>

    <span class="c"># environment</span>
    <span class="n">wind_rho</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.225</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;air density&#39;</span><span class="p">)</span>
    <span class="n">wind_mu</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.7934e-5</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/(m*s)&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dynamic viscosity of air&#39;</span><span class="p">)</span>
    <span class="n">wind_Uref1</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;reference wind speed (usually at hub height)&#39;</span><span class="p">)</span>
    <span class="n">wind_Uref2</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;reference wind speed (usually at hub height)&#39;</span><span class="p">)</span>
    <span class="n">wind_zref</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;corresponding reference height&#39;</span><span class="p">)</span>
    <span class="n">wind_z0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;bottom of wind profile (height of ground/sea)&#39;</span><span class="p">)</span>

    <span class="n">wave_rho</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1027.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;water density&#39;</span><span class="p">)</span>
    <span class="n">wave_mu</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.3351e-3</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/(m*s)&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dynamic viscosity of water&#39;</span><span class="p">)</span>
    <span class="n">wave_cm</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass coefficient&#39;</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;acceleration of gravity&#39;</span><span class="p">)</span>

    <span class="c"># constraint parameters</span>
    <span class="n">min_d_to_t</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">120.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;minimum allowable diameter to thickness ratio&#39;</span><span class="p">)</span>
    <span class="n">min_taper</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;minimum allowable taper ratio from tower top to tower bottom&#39;</span><span class="p">)</span>


    <span class="c"># rotor loads</span>
    <span class="n">rotorF1</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;forces in hub-aligned coordinate system at rotor hub&#39;</span><span class="p">)</span>
    <span class="n">rotorM1</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;moments in hub-aligned coordinate system at rotor hub&#39;</span><span class="p">)</span>
    <span class="n">rotorF2</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;forces in hub-aligned coordinate system at rotor hub&#39;</span><span class="p">)</span>
    <span class="n">rotorM2</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;moments in hub-aligned coordinate system at rotor hub&#39;</span><span class="p">)</span>

    <span class="c"># RNA mass properties</span>
    <span class="n">blades_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of all blades&#39;</span><span class="p">)</span>
    <span class="n">hub_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of hub&#39;</span><span class="p">)</span>
    <span class="n">nac_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of nacelle&#39;</span><span class="p">)</span>

    <span class="n">hub_cm</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of hub center of mass relative to tower top in yaw-aligned c.s.&#39;</span><span class="p">)</span>
    <span class="n">nac_cm</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of nacelle center of mass relative to tower top in yaw-aligned c.s.&#39;</span><span class="p">)</span>

    <span class="n">blades_I</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of all blades about hub center&#39;</span><span class="p">)</span>
    <span class="n">hub_I</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of hub about its center of mass&#39;</span><span class="p">)</span>
    <span class="n">nac_I</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of nacelle about its center of mass&#39;</span><span class="p">)</span>

    <span class="c"># material properties</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">210e9</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;material modulus of elasticity&#39;</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">80.8e9</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;material shear modulus&#39;</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">8500.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;material density&#39;</span><span class="p">)</span>
    <span class="n">sigma_y</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">450.0e6</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;yield stress&#39;</span><span class="p">)</span>

    <span class="c"># safety factors</span>
    <span class="n">gamma_f</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.35</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor on loads&#39;</span><span class="p">)</span>
    <span class="n">gamma_m</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor on materials&#39;</span><span class="p">)</span>
    <span class="n">gamma_n</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor on consequence of failure&#39;</span><span class="p">)</span>
    <span class="n">gamma_b</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;buckling safety factor&#39;</span><span class="p">)</span>

    <span class="c"># fatigue parameters</span>
    <span class="n">life</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue life of tower&#39;</span><span class="p">)</span>
    <span class="n">m_SN</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;slope of S/N curve&#39;</span><span class="p">)</span>
    <span class="n">DC</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;standard value of stress&#39;</span><span class="p">)</span>
    <span class="n">gamma_fatigue</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.755</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total safety factor for fatigue&#39;</span><span class="p">)</span>
    <span class="n">z_DEL</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations along unit tower for M_DEL&#39;</span><span class="p">)</span>
    <span class="n">M_DEL</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments along tower&#39;</span><span class="p">)</span>

    <span class="c"># replace</span>
    <span class="n">wind1</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">WindBase</span><span class="p">)</span>
    <span class="n">wind2</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">WindBase</span><span class="p">)</span>
    <span class="n">wave1</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">WaveBase</span><span class="p">)</span>
    <span class="n">wave2</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">WaveBase</span><span class="p">)</span>
    <span class="n">soil</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">SoilBase</span><span class="p">)</span>
    <span class="n">tower1</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">TowerBase</span><span class="p">)</span>
    <span class="n">tower2</span> <span class="o">=</span> <span class="n">Slot</span><span class="p">(</span><span class="n">TowerBase</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first natural frequency&#39;</span><span class="p">)</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;second natural frequency&#39;</span><span class="p">)</span>
    <span class="n">top_deflection1</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of tower top in yaw-aligned +x direction&#39;</span><span class="p">)</span>
    <span class="n">top_deflection2</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of tower top in yaw-aligned +x direction&#39;</span><span class="p">)</span>
    <span class="n">z_nodes</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
    <span class="n">stress1</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;von Mises stress along tower on downwind side (yaw-aligned +x).  normalized by yield stress.  includes safety factors.&#39;</span><span class="p">)</span>
    <span class="n">stress2</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;von Mises stress along tower on downwind side (yaw-aligned +x).  normalized by yield stress.  includes safety factors.&#39;</span><span class="p">)</span>
    <span class="n">shellBuckling1</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a shell buckling constraint.  should be &lt;= 0 for feasibility.  includes safety factors&#39;</span><span class="p">)</span>
    <span class="n">shellBuckling2</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a shell buckling constraint.  should be &lt;= 0 for feasibility.  includes safety factors&#39;</span><span class="p">)</span>
    <span class="n">buckling1</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a global buckling constraint.  should be &lt;= 0 for feasibility.  includes safety factors&#39;</span><span class="p">)</span>
    <span class="n">buckling2</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a global buckling constraint.  should be &lt;= 0 for feasibility.  includes safety factors&#39;</span><span class="p">)</span>
    <span class="n">damage</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage at each tower section&#39;</span><span class="p">)</span>
    <span class="n">weldability</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>
    <span class="n">manufactuability</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">TowerDiscretization</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;wind1&#39;</span><span class="p">,</span> <span class="n">WindBase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;wind2&#39;</span><span class="p">,</span> <span class="n">WindBase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;wave1&#39;</span><span class="p">,</span> <span class="n">WaveBase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;wave2&#39;</span><span class="p">,</span> <span class="n">WaveBase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;windLoads1&#39;</span><span class="p">,</span> <span class="n">TowerWindDrag</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;windLoads2&#39;</span><span class="p">,</span> <span class="n">TowerWindDrag</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;waveLoads1&#39;</span><span class="p">,</span> <span class="n">TowerWaveDrag</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;waveLoads2&#39;</span><span class="p">,</span> <span class="n">TowerWaveDrag</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;soil&#39;</span><span class="p">,</span> <span class="n">SoilBase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;rna&#39;</span><span class="p">,</span> <span class="n">RNAMass</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;rotorloads1&#39;</span><span class="p">,</span> <span class="n">RotorLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;rotorloads2&#39;</span><span class="p">,</span> <span class="n">RotorLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;tower1&#39;</span><span class="p">,</span> <span class="n">TowerBase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;tower2&#39;</span><span class="p">,</span> <span class="n">TowerBase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;gc&#39;</span><span class="p">,</span> <span class="n">GeometricConstraints</span><span class="p">())</span>

        <span class="c"># self.driver.workflow.add([&#39;geometry&#39;, &#39;wind&#39;, &#39;wave&#39;, &#39;windLoads&#39;, &#39;waveLoads&#39;, &#39;soil&#39;, &#39;rna&#39;, &#39;rotorloads&#39;, &#39;tower&#39;])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;geometry&#39;</span><span class="p">,</span> <span class="s">&#39;wind1&#39;</span><span class="p">,</span> <span class="s">&#39;wind2&#39;</span><span class="p">,</span> <span class="s">&#39;wave1&#39;</span><span class="p">,</span> <span class="s">&#39;wave2&#39;</span><span class="p">,</span>
            <span class="s">&#39;windLoads1&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads2&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2&#39;</span><span class="p">,</span> <span class="s">&#39;soil&#39;</span><span class="p">,</span> <span class="s">&#39;rna&#39;</span><span class="p">,</span>
            <span class="s">&#39;rotorloads1&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2&#39;</span><span class="p">,</span> <span class="s">&#39;tower1&#39;</span><span class="p">,</span> <span class="s">&#39;tower2&#39;</span><span class="p">,</span> <span class="s">&#39;gc&#39;</span><span class="p">])</span>
        <span class="c"># TODO: probably better to do this with a driver or something rather than manually setting 2 cases</span>

        <span class="c"># connections to geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;towerHeight&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.towerHeight&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;monopileHeight&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.monopileHeight&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;d_monopile&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.d_monopile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;t_monopile&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.t_monopile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.t&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;n_monopile&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.n_monopile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;L_reinforced&#39;</span><span class="p">,</span> <span class="s">&#39;geometry.L_reinforced&#39;</span><span class="p">)</span>


        <span class="c"># connections to wind1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;wind1.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_Uref1&#39;</span><span class="p">,</span> <span class="s">&#39;wind1.Uref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_zref&#39;</span><span class="p">,</span> <span class="s">&#39;wind1.zref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_z0&#39;</span><span class="p">,</span> <span class="s">&#39;wind1.z0&#39;</span><span class="p">)</span>

        <span class="c"># connections to wind2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;wind2.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_Uref2&#39;</span><span class="p">,</span> <span class="s">&#39;wind2.Uref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_zref&#39;</span><span class="p">,</span> <span class="s">&#39;wind2.zref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_z0&#39;</span><span class="p">,</span> <span class="s">&#39;wind2.z0&#39;</span><span class="p">)</span>

        <span class="c"># connections to wave1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;wave1.z&#39;</span><span class="p">)</span>

        <span class="c"># connections to wave2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;wave2.z&#39;</span><span class="p">)</span>

        <span class="c"># connections to windLoads1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind1.U&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads1.U&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind1.beta&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads1.beta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_rho&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads1.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_mu&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads1.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads1.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.d_node&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads1.d&#39;</span><span class="p">)</span>

        <span class="c"># connections to windLoads2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind2.U&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads2.U&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind2.beta&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads2.beta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_rho&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads2.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind_mu&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads2.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads2.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.d_node&#39;</span><span class="p">,</span> <span class="s">&#39;windLoads2.d&#39;</span><span class="p">)</span>

        <span class="c"># connections to waveLoads1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave1.U&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.U&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave1.A&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.A&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave1.beta&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.beta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave_rho&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave_mu&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave_cm&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.d_node&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads1.d&#39;</span><span class="p">)</span>

        <span class="c"># connections to waveLoads2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave2.U&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.U&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave2.A&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.A&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave2.beta&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.beta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave_rho&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave_mu&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wave_cm&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.d_node&#39;</span><span class="p">,</span> <span class="s">&#39;waveLoads2.d&#39;</span><span class="p">)</span>

        <span class="c"># connections to rna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;blades_mass&#39;</span><span class="p">,</span> <span class="s">&#39;rna.blades_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;blades_I&#39;</span><span class="p">,</span> <span class="s">&#39;rna.blades_I&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hub_mass&#39;</span><span class="p">,</span> <span class="s">&#39;rna.hub_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hub_cm&#39;</span><span class="p">,</span> <span class="s">&#39;rna.hub_cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hub_I&#39;</span><span class="p">,</span> <span class="s">&#39;rna.hub_I&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nac_mass&#39;</span><span class="p">,</span> <span class="s">&#39;rna.nac_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nac_cm&#39;</span><span class="p">,</span> <span class="s">&#39;rna.nac_cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nac_I&#39;</span><span class="p">,</span> <span class="s">&#39;rna.nac_I&#39;</span><span class="p">)</span>

        <span class="c"># connections to rotorloads1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;downwind&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.downwind&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorF1&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorM1&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.M&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hub_cm&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.r_hub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_cm&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.rna_cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.g&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_mass&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads1.m_RNA&#39;</span><span class="p">)</span>

        <span class="c"># connections to rotorloads2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;downwind&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.downwind&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorF2&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorM2&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.M&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hub_cm&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.r_hub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_cm&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.rna_cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.g&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_mass&#39;</span><span class="p">,</span> <span class="s">&#39;rotorloads2.m_RNA&#39;</span><span class="p">)</span>

        <span class="c"># connections to tower</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;towerHeight&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.towerHeight&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.d_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.t_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.t&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.L_reinforced_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.L_reinforced&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;windLoads1.windLoads&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.windLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;waveLoads1.waveLoads&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.waveLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;soil.k&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.k_soil&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_mass&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.top_m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_cm&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.top_cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_I_TT&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.top_I&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorloads1.top_F&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.top_F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorloads1.top_M&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.top_M&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;yaw&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.g&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.E&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.G&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sigma_y&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.sigma_y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_f&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.gamma_f&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_m&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.gamma_m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_n&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.gamma_n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_b&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.gamma_b&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;life&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.life&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;m_SN&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.m_SN&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;DC&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.DC&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_fatigue&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.gamma_fatigue&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;z_DEL&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.z_DEL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;M_DEL&#39;</span><span class="p">,</span> <span class="s">&#39;tower1.M_DEL&#39;</span><span class="p">)</span>

        <span class="c"># connections to tower</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;towerHeight&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.towerHeight&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.z_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.z&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.d_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.t_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.t&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geometry.L_reinforced_node&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.L_reinforced&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;windLoads2.windLoads&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.windLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;waveLoads2.waveLoads&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.waveLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;soil.k&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.k_soil&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_mass&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.top_m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_cm&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.top_cm&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rna.rna_I_TT&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.top_I&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorloads2.top_F&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.top_F&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rotorloads2.top_M&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.top_M&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;yaw&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.g&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.E&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.G&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sigma_y&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.sigma_y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_f&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.gamma_f&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_m&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.gamma_m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_n&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.gamma_n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_b&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.gamma_b&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;life&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.life&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;m_SN&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.m_SN&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;DC&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.DC&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gamma_fatigue&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.gamma_fatigue&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;z_DEL&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.z_DEL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;M_DEL&#39;</span><span class="p">,</span> <span class="s">&#39;tower2.M_DEL&#39;</span><span class="p">)</span>

        <span class="c"># connections to gc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;gc.d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;gc.t&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;min_d_to_t&#39;</span><span class="p">,</span> <span class="s">&#39;gc.min_d_to_t&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;min_taper&#39;</span><span class="p">,</span> <span class="s">&#39;gc.min_taper&#39;</span><span class="p">)</span>



        <span class="c"># connections to outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.mass&#39;</span><span class="p">,</span> <span class="s">&#39;mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.f1&#39;</span><span class="p">,</span> <span class="s">&#39;f1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.f2&#39;</span><span class="p">,</span> <span class="s">&#39;f2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.top_deflection&#39;</span><span class="p">,</span> <span class="s">&#39;top_deflection1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower2.top_deflection&#39;</span><span class="p">,</span> <span class="s">&#39;top_deflection2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.z&#39;</span><span class="p">,</span> <span class="s">&#39;z_nodes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.stress&#39;</span><span class="p">,</span> <span class="s">&#39;stress1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower2.stress&#39;</span><span class="p">,</span> <span class="s">&#39;stress2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.buckling&#39;</span><span class="p">,</span> <span class="s">&#39;buckling1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower2.buckling&#39;</span><span class="p">,</span> <span class="s">&#39;buckling2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.shellBuckling&#39;</span><span class="p">,</span> <span class="s">&#39;shellBuckling1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower2.shellBuckling&#39;</span><span class="p">,</span> <span class="s">&#39;shellBuckling2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tower1.damage&#39;</span><span class="p">,</span> <span class="s">&#39;damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gc.weldability&#39;</span><span class="p">,</span> <span class="s">&#39;weldability&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gc.manufactuability&#39;</span><span class="p">,</span> <span class="s">&#39;manufactuability&#39;</span><span class="p">)</span>


</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>


    <span class="n">optimize</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># --- tower setup ------</span>
    <span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="kn">import</span> <span class="n">PowerWind</span><span class="p">,</span> <span class="n">TowerSoil</span>
    <span class="c"># from towerse.tower import TowerWithpBEAM</span>

    <span class="n">tower</span> <span class="o">=</span> <span class="n">TowerSE</span><span class="p">()</span>

    <span class="n">tower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;wind1&#39;</span><span class="p">,</span> <span class="n">PowerWind</span><span class="p">())</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;wind2&#39;</span><span class="p">,</span> <span class="n">PowerWind</span><span class="p">())</span>
    <span class="c"># onshore (no waves)</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;soil&#39;</span><span class="p">,</span> <span class="n">TowerSoil</span><span class="p">())</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;tower1&#39;</span><span class="p">,</span> <span class="n">TowerWithpBEAM</span><span class="p">())</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;tower2&#39;</span><span class="p">,</span> <span class="n">TowerWithpBEAM</span><span class="p">())</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- geometry ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">towerHeight</span> <span class="o">=</span> <span class="mf">87.6</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.935</span><span class="p">,</span> <span class="mf">3.87</span><span class="p">]</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.027</span><span class="o">*</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.023</span><span class="o">*</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.019</span><span class="o">*</span><span class="mf">1.3</span><span class="p">]</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">L_reinforced</span> <span class="o">=</span> <span class="mf">30.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- blades ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">blades_mass</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">15241.323</span>
    <span class="n">bladeI</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">8791992.000</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">blades_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bladeI</span><span class="p">,</span> <span class="n">bladeI</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">bladeI</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- hub ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">hub_mass</span> <span class="o">=</span> <span class="mf">50421.4</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">hub_cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">6.30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.15</span><span class="p">])</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">hub_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">127297.8</span><span class="p">,</span> <span class="mf">127297.8</span><span class="p">,</span> <span class="mf">127297.8</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- nacelle ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">nac_mass</span> <span class="o">=</span> <span class="mf">221245.8</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">nac_cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.32</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.40</span><span class="p">])</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">nac_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9908302.58</span><span class="p">,</span> <span class="mf">912488.28</span><span class="p">,</span> <span class="mf">1160903.54</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- wind ---</span>
    <span class="n">towerToShaft</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">wind_zref</span> <span class="o">=</span> <span class="n">tower</span><span class="o">.</span><span class="n">towerHeight</span> <span class="o">+</span> <span class="n">towerToShaft</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">wind_z0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">wind1</span><span class="o">.</span><span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">wind2</span><span class="o">.</span><span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- soil ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">soil</span><span class="o">.</span><span class="n">rigid</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="bp">True</span><span class="p">]</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- loading case 1: max Thrust ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">wind_Uref1</span> <span class="o">=</span> <span class="mf">16.030</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">rotorF1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.3295e6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">rotorM1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">6.2829e6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- loading case 2: max wind speed ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">wind_Uref2</span> <span class="o">=</span> <span class="mf">67.89</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">rotorF2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1770e6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">rotorM2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5730e6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- safety factors ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">gamma_f</span> <span class="o">=</span> <span class="mf">1.35</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">gamma_m</span> <span class="o">=</span> <span class="mf">1.3</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">gamma_n</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">gamma_b</span> <span class="o">=</span> <span class="mf">1.1</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- fatigue ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">z_DEL</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">87.6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">1.327</span><span class="p">,</span> <span class="mf">3.982</span><span class="p">,</span> <span class="mf">6.636</span><span class="p">,</span> <span class="mf">9.291</span><span class="p">,</span> <span class="mf">11.945</span><span class="p">,</span> <span class="mf">14.600</span><span class="p">,</span> <span class="mf">17.255</span><span class="p">,</span> <span class="mf">19.909</span><span class="p">,</span> <span class="mf">22.564</span><span class="p">,</span> <span class="mf">25.218</span><span class="p">,</span> <span class="mf">27.873</span><span class="p">,</span> <span class="mf">30.527</span><span class="p">,</span> <span class="mf">33.182</span><span class="p">,</span> <span class="mf">35.836</span><span class="p">,</span> <span class="mf">38.491</span><span class="p">,</span> <span class="mf">41.145</span><span class="p">,</span> <span class="mf">43.800</span><span class="p">,</span> <span class="mf">46.455</span><span class="p">,</span> <span class="mf">49.109</span><span class="p">,</span> <span class="mf">51.764</span><span class="p">,</span> <span class="mf">54.418</span><span class="p">,</span> <span class="mf">57.073</span><span class="p">,</span> <span class="mf">59.727</span><span class="p">,</span> <span class="mf">62.382</span><span class="p">,</span> <span class="mf">65.036</span><span class="p">,</span> <span class="mf">67.691</span><span class="p">,</span> <span class="mf">70.345</span><span class="p">,</span> <span class="mf">73.000</span><span class="p">,</span> <span class="mf">75.655</span><span class="p">,</span> <span class="mf">78.309</span><span class="p">,</span> <span class="mf">80.964</span><span class="p">,</span> <span class="mf">83.618</span><span class="p">,</span> <span class="mf">86.273</span><span class="p">,</span> <span class="mf">87.600</span><span class="p">])</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">M_DEL</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.2940E+003</span><span class="p">,</span> <span class="mf">8.1518E+003</span><span class="p">,</span> <span class="mf">7.8831E+003</span><span class="p">,</span> <span class="mf">7.6099E+003</span><span class="p">,</span> <span class="mf">7.3359E+003</span><span class="p">,</span> <span class="mf">7.0577E+003</span><span class="p">,</span> <span class="mf">6.7821E+003</span><span class="p">,</span> <span class="mf">6.5119E+003</span><span class="p">,</span> <span class="mf">6.2391E+003</span><span class="p">,</span> <span class="mf">5.9707E+003</span><span class="p">,</span> <span class="mf">5.7070E+003</span><span class="p">,</span> <span class="mf">5.4500E+003</span><span class="p">,</span> <span class="mf">5.2015E+003</span><span class="p">,</span> <span class="mf">4.9588E+003</span><span class="p">,</span> <span class="mf">4.7202E+003</span><span class="p">,</span> <span class="mf">4.4884E+003</span><span class="p">,</span> <span class="mf">4.2577E+003</span><span class="p">,</span> <span class="mf">4.0246E+003</span><span class="p">,</span> <span class="mf">3.7942E+003</span><span class="p">,</span> <span class="mf">3.5664E+003</span><span class="p">,</span> <span class="mf">3.3406E+003</span><span class="p">,</span> <span class="mf">3.1184E+003</span><span class="p">,</span> <span class="mf">2.8977E+003</span><span class="p">,</span> <span class="mf">2.6811E+003</span><span class="p">,</span> <span class="mf">2.4719E+003</span><span class="p">,</span> <span class="mf">2.2663E+003</span><span class="p">,</span> <span class="mf">2.0673E+003</span><span class="p">,</span> <span class="mf">1.8769E+003</span><span class="p">,</span> <span class="mf">1.7017E+003</span><span class="p">,</span> <span class="mf">1.5479E+003</span><span class="p">,</span> <span class="mf">1.4207E+003</span><span class="p">,</span> <span class="mf">1.3304E+003</span><span class="p">,</span> <span class="mf">1.2780E+003</span><span class="p">,</span> <span class="mf">1.2673E+003</span><span class="p">,</span> <span class="mf">1.2761E+003</span><span class="p">])</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">gamma_fatigue</span> <span class="o">=</span> <span class="mf">1.35</span><span class="o">*</span><span class="mf">1.3</span><span class="o">*</span><span class="mf">1.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">life</span> <span class="o">=</span> <span class="mf">20.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">m_SN</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c"># ---------------</span>

    <span class="c"># --- constraints ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">min_d_to_t</span> <span class="o">=</span> <span class="mf">120.0</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">min_taper</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="c"># ---------------</span>

    <span class="c"># V_max = 80.0  # tip speed</span>
    <span class="c"># D = 126.0</span>
    <span class="c"># tower.freq1p = V_max / (D/2) / (2*pi)  # convert to Hz</span>


    <span class="c"># use defaults</span>
    <span class="c"># tower.wind_rho</span>
    <span class="c"># tower.wind_mu</span>
    <span class="c"># tower.g</span>
    <span class="c"># tower.E</span>
    <span class="c"># tower.G</span>
    <span class="c"># tower.rho</span>
    <span class="c"># tower.sigma_y</span>

    <span class="c"># onshore</span>
    <span class="c"># tower.wave_rho</span>
    <span class="c"># tower.wave_mu</span>
    <span class="c"># tower.wave_cm</span>

    <span class="c"># --- run ---</span>
    <span class="n">tower</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&#39;mass (kg) =&#39;</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">mass</span>
    <span class="k">print</span> <span class="s">&#39;f1 (Hz) =&#39;</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">f1</span>
    <span class="k">print</span> <span class="s">&#39;f2 (Hz) =&#39;</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">f2</span>
    <span class="k">print</span> <span class="s">&#39;top_deflection1 (m) =&#39;</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">top_deflection1</span>
    <span class="k">print</span> <span class="s">&#39;top_deflection2 (m) =&#39;</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">top_deflection2</span>
    <span class="k">print</span> <span class="s">&#39;weldability =&#39;</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">weldability</span>
    <span class="k">print</span> <span class="s">&#39;manufactuability =&#39;</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">manufactuability</span>


    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tower</span><span class="o">.</span><span class="n">stress1</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;stress1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tower</span><span class="o">.</span><span class="n">stress2</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;stress2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tower</span><span class="o">.</span><span class="n">shellBuckling1</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;shell buckling 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tower</span><span class="o">.</span><span class="n">shellBuckling2</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;shell buckling 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tower</span><span class="o">.</span><span class="n">buckling1</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;global buckling 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tower</span><span class="o">.</span><span class="n">buckling2</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;global buckling 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tower</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span> <span class="n">tower</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;damage&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;utilization&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;height along tower (m)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c"># ------------</span>


    <span class="k">if</span> <span class="n">optimize</span><span class="p">:</span>

        <span class="c"># --- optimizer imports ---</span>
        <span class="kn">from</span> <span class="nn">pyopt_driver.pyopt_driver</span> <span class="kn">import</span> <span class="n">pyOptDriver</span>
        <span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">DumpCaseRecorder</span>
        <span class="c"># ----------------------</span>

        <span class="c"># --- Setup Pptimizer ---</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">pyOptDriver</span><span class="p">())</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s">&#39;SNOPT&#39;</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Major feasibility tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                               <span class="s">&#39;Minor feasibility tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                               <span class="s">&#39;Major optimality tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
                               <span class="s">&#39;Function precision&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">}</span>
        <span class="c"># ----------------------</span>

        <span class="c"># --- Objective ---</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s">&#39;tower1.mass / 300000&#39;</span><span class="p">)</span>
        <span class="c"># ----------------------</span>

        <span class="c"># --- Design Variables ---</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;z[1]&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;d[:-1]&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">3.87</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c"># ----------------------</span>

        <span class="c"># --- recorder ---</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">recorders</span> <span class="o">=</span> <span class="p">[</span><span class="n">DumpCaseRecorder</span><span class="p">()]</span>
        <span class="c"># ----------------------</span>

        <span class="c"># --- Constraints ---</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower1.stress &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower2.stress &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower1.buckling &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower2.buckling &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower1.shellBuckling &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower2.shellBuckling &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower1.damage &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;gc.weldability &lt;= 0.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;gc.manufactuability &lt;= 0.0&#39;</span><span class="p">)</span>
        <span class="n">freq1p</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c"># 1P freq in Hz</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;tower1.f1 &gt;= 1.1*</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">freq1p</span><span class="p">)</span>
        <span class="c"># ----------------------</span>

        <span class="c"># --- run opt ---</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="c"># ---------------</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">TowerSE 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, NREL.
      Last updated on Jul 11, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>